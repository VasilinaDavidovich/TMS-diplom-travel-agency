{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card bg-dark text-white">
                <div class="card-body">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∞ -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h3>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h3>
                            <p class="text-muted mb-0" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        </div>
                        <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                            –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                        </button>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∏ -->
                    <ul class="nav nav-tabs mb-4">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#bookings">–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#favorites">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#reviews">üìù –ú–æ–∏ –æ—Ç–∑—ã–≤—ã</a>
                        </li>
                    </ul>

                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
                    <div class="tab-content">
                        <!-- –í–∫–ª–∞–¥–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
                        <div class="tab-pane fade show active" id="bookings">
                            <h5>üìÖ –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                            <p class="text-muted" id="bookingsSummary">–ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π...</p>
                            <div id="bookingsList">
                                <!-- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                            </div>
                        </div>

                        <!-- –í–∫–ª–∞–¥–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
                        <div class="tab-pane fade" id="favorites">
                            <h5>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏</h5>
                            <p class="text-muted" id="favoritesSummary">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π...</p>
                            <div id="favoritesList">
                                <!-- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </div>
                        </div>

                        <!-- –í–∫–ª–∞–¥–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ -->
                        <div class="tab-pane fade" id="reviews">
                            <h5>üìù –ú–æ–∏ –æ—Ç–∑—ã–≤—ã</h5>
                            <p class="text-muted" id="reviewsSummary">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</p>
                            <div id="reviewsList">
                                <!-- –û—Ç–∑—ã–≤—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
                    <div class="mt-4 text-center">
                        <button class="btn btn-outline-secondary" onclick="logout()">
                            –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger">‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</p>
                <p class="text-warning"><strong>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</strong></p>
                <ul class="text-muted small">
                    <li>–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã</li>
                    <li>–ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø—Ä–æ–ø–∞–¥–µ—Ç</li>
                    <li>–û—Ç–∑—ã–≤—ã –±—É–¥—É—Ç –∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã</li>
                </ul>
                <p>–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ: <code class="text-warning">–£–î–ê–õ–ò–¢–¨ –ê–ö–ö–ê–£–ù–¢</code></p>
                <input type="text" class="form-control mb-3" id="confirmDeleteInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è">
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled onclick="deleteAccount()">
                    –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.rating-trophies-small {
    font-size: 16px;
    margin-left: 10px;
}

.rating-display {
    font-size: 18px;
    font-weight: bold;
    color: #ffd700;
}

.rating-value {
    background: rgba(255, 215, 0, 0.2);
    padding: 5px 10px;
    border-radius: 15px;
}

.review-item {
    border-left: 4px solid #4d7cfe;
}
</style>

<script>
function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        window.location.href = '/';
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadUserData();

    // –í–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤–≤–æ–¥–µ
    const confirmInput = document.getElementById('confirmDeleteInput');
    const confirmBtn = document.getElementById('confirmDeleteBtn');

    if (confirmInput && confirmBtn) {
        confirmInput.addEventListener('input', function() {
            confirmBtn.disabled = this.value !== '–£–î–ê–õ–ò–¢–¨ –ê–ö–ö–ê–£–ù–¢';
        });
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
async function loadUserData() {
    const token = localStorage.getItem('access_token');
    if (!token) {
        window.location.href = '/';
        return;
    }

    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        const userResponse = await fetch('/api/auth/current-user/', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (userResponse.ok) {
            const userData = await userResponse.json();
            const userInfo = document.getElementById('userInfo');
            if (userInfo) {
                userInfo.innerHTML = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <strong>${userData.username}</strong>`;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            await loadUserBookings();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏
            await loadUserFavorites();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã
            await loadUserReviews();
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function loadUserBookings() {
    const token = localStorage.getItem('access_token');
    if (!token) return;

    try {
        const response = await fetch('/api/bookings/', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            const bookings = await response.json();
            displayBookings(bookings);
        } else {
            document.getElementById('bookingsSummary').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:', error);
        document.getElementById('bookingsSummary').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
function displayBookings(bookings) {
    const container = document.getElementById('bookingsList');
    const summary = document.getElementById('bookingsSummary');

    if (bookings.length === 0) {
        summary.textContent = '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π';
        container.innerHTML = `
            <div class="text-center py-4">
                <p class="text-muted">üéØ –ù–∞—á–Ω–∏—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ!</p>
                <a href="/" class="btn btn-primary">–ù–∞–π—Ç–∏ –æ—Ç–µ–ª–∏</a>
            </div>
        `;
        return;
    }

    summary.textContent = `–ù–∞–π–¥–µ–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${bookings.length}`;

    container.innerHTML = bookings.map(booking => `
        <div class="card bg-dark text-white mb-3">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6>üè® ${booking.hotel_name}</h6>
                        <p class="mb-1">
                            üìÖ ${new Date(booking.check_in).toLocaleDateString('ru-RU')}
                            - ${new Date(booking.check_out).toLocaleDateString('ru-RU')}
                        </p>
                        <p class="mb-1">üë• –ì–æ—Å—Ç–µ–π: ${booking.guests}</p>
                        <p class="mb-1">üí∞ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <strong>${booking.total_price}‚Ç¨</strong></p>
                        <small class="text-muted">
                            üìã –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ: ${new Date(booking.created_at).toLocaleDateString('ru-RU')}
                        </small>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="badge bg-success mb-2">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</div>
                        <br>
                        <small class="text-muted">ID: #${booking.id}</small>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π
async function loadUserFavorites() {
    const token = localStorage.getItem('access_token');
    if (!token) return;

    try {
        const response = await fetch('/api/favorites/', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            const favorites = await response.json();
            displayFavorites(favorites);
        } else {
            document.getElementById('favoritesSummary').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π:', error);
        document.getElementById('favoritesSummary').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π
function displayFavorites(favorites) {
    const container = document.getElementById('favoritesList');
    const summary = document.getElementById('favoritesSummary');

    if (favorites.length === 0) {
        summary.textContent = '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π';
        container.innerHTML = `
            <div class="text-center py-4">
                <p class="text-muted">‚ù§Ô∏è –î–æ–±–∞–≤–ª—è–π—Ç–µ –æ—Ç–µ–ª–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å!</p>
                <a href="/" class="btn btn-primary">–ù–∞–π—Ç–∏ –æ—Ç–µ–ª–∏</a>
            </div>
        `;
        return;
    }

    summary.textContent = `–ò–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π: ${favorites.length}`;

    container.innerHTML = favorites.map(fav => `
        <div class="card bg-dark text-white mb-3">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6>üè® ${fav.hotel_name}</h6>
                        <p class="mb-1">üìç ${fav.hotel_city}, ${fav.hotel_country}</p>
                        <p class="mb-1">üí∞ –¶–µ–Ω–∞: <strong class="text-warning">${fav.hotel_price}‚Ç¨ / –Ω–æ—á—å</strong></p>
                        <small class="text-muted">
                            üìã –î–æ–±–∞–≤–ª–µ–Ω–æ: ${new Date(fav.created_at).toLocaleDateString('ru-RU')}
                        </small>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="mb-2">
                            <a href="/hotel/${fav.hotel}/" class="btn btn-primary btn-sm me-2">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            <button class="btn btn-outline-danger btn-sm" onclick="removeFromFavorites(${fav.id})">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                        ${fav.hotel_image ?
                            `<img src="${fav.hotel_image}" class="img-fluid rounded" style="height: 80px; width: 100%; object-fit: cover;" alt="${fav.hotel_name}">` :
                            '<div class="text-muted small">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>'
                        }
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function loadUserReviews() {
    const token = localStorage.getItem('access_token');
    if (!token) return;

    try {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º username —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userResponse = await fetch('/api/auth/current-user/', {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (userResponse.ok) {
            const userData = await userResponse.json();
            const response = await fetch('/api/reviews/?user=' + userData.username, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                }
            });

            if (response.ok) {
                const reviews = await response.json();
                displayUserReviews(reviews);
            } else {
                document.getElementById('reviewsSummary').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤';
            }
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤:', error);
        document.getElementById('reviewsSummary').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function displayUserReviews(reviews) {
    const container = document.getElementById('reviewsList');
    const summary = document.getElementById('reviewsSummary');

    if (reviews.length === 0) {
        summary.textContent = '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤';
        container.innerHTML = `
            <div class="text-center py-4">
                <p class="text-muted">üí¨ –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º –æ–± –æ—Ç–µ–ª—è—Ö!</p>
                <a href="/" class="btn btn-primary">–ù–∞–π—Ç–∏ –æ—Ç–µ–ª–∏</a>
            </div>
        `;
        return;
    }

    summary.textContent = `–ù–∞–π–¥–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: ${reviews.length}`;

    container.innerHTML = reviews.map(review => `
        <div class="card bg-dark text-white mb-3 review-item">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6>üè® ${review.hotel_name || '–û—Ç–µ–ª—å'}</h6>
                        <div class="d-flex align-items-center mb-2">
                            <div class="rating-trophies-small">
                                ${'üèÜ'.repeat(review.rating)}
                            </div>
                            <small class="text-muted ms-2">
                                ${new Date(review.created_at).toLocaleDateString('ru-RU')}
                            </small>
                        </div>
                        <p class="mb-1">${review.comment}</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="rating-display mb-2">
                            <span class="rating-value">${review.rating}/5</span>
                        </div>
                        <div class="mb-2">
                            <a href="/hotel/${review.hotel}/"
                               class="btn btn-primary btn-sm me-2">
                                –ö –æ—Ç–µ–ª—é
                            </a>
                            <button class="btn btn-outline-danger btn-sm"
                                    onclick="deleteReview(${review.id})">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
async function removeFromFavorites(favoriteId) {
    const token = localStorage.getItem('access_token');
    if (!token) return;

    if (!confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–µ–ª—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ?')) {
        return;
    }

    try {
        const response = await fetch(`/api/favorites/${favoriteId}/`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            alert('‚ùå –û—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            await loadUserFavorites();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
async function deleteReview(reviewId) {
    const token = localStorage.getItem('access_token');
    if (!token) return;

    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤?')) {
        return;
    }

    try {
        const response = await fetch(`/api/reviews/${reviewId}/`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            alert('‚úÖ –û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤
            await loadUserReviews();
        } else {
            const error = await response.json();
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞: ' + JSON.stringify(error));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞');
    }
}

async function deleteAccount() {
    const token = localStorage.getItem('access_token');

    try {
        const response = await fetch('/api/auth/delete-account/', {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            alert('‚úÖ –ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            window.location.href = '/';
        } else {
            const error = await response.json();
            alert('‚ùå –û—à–∏–±–∫–∞: ' + JSON.stringify(error));
        }
    } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
    }

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteAccountModal'));
    modal.hide();
}
</script>
{% endblock %}